<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ãƒ¬ã‚¤ãƒ©ãƒ»ãƒã‚°ãƒãƒªã‚¢éå…¬å¼ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆ</title>
        <link rel="stylesheet" type="text/css" href="./css/style.css">
        <!--link rel="icon" type="image/x-icon" href="./layla_twitter_icon.jpg"-->

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-1GJHHNYD65"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-1GJHHNYD65');
        </script>
        <script>
            (function(d) {
              var config = {
                kitId: 'vnx5ouf',
                scriptTimeout: 3000,
                async: true
              },
              h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
            })(document);
        </script>

    </head>

        

    <body>
        <header class="header">
            <div class="header_inner">
                <div class="logo">
                    <img id="layla_logo" src="layla_funsite_log.png" onclick="secBtn()">
                </div>
                <nav class="nav">
                    <ul class="nav_list">
                        <li class="nav_item"><a href="https://ringodeveloper.github.io/kon-layla/">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</a></li>
                        <li class="nav_item"><a href="https://ringodeveloper.github.io/POTY2022/">POTY</a></li>
                        <li class="nav_item"><a href="https://ringodeveloper.github.io/kon-layla/qa.html">ãŠå•ã„åˆã‚ã›</a></li>
                    </ul>
                </nav>
            </div>
            <div class="hamburger" id="js-hamburger">
                <span class="hamburger_border hamburger_border_top"></span>
                <span class="hamburger_border hamburger_border_center"></span>
                <span class="hamburger_border hamburger_border_bottom"></span>
            </div>
            <div class="black_bg" id="js-black-bg"></div>
        </header>
        
        <main class="main">
            <div id="link">
                <a href="https://twitter.com/Layla__Magnolia?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @Layla__Magnolia</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><br>
                <a href="https://twitter.com/intent/tweet?button_hashtag=ãªã¾ãƒ¢ã‚¯ãƒ¬ãƒ³&ref_src=twsrc%5Etfw" class="twitter-hashtag-button" data-show-count="false">#ãªã¾ãƒ¢ã‚¯ãƒ¬ãƒ³ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹</a>
            </div>
            <img class="ringo" id="ringo" src="ringodev_logo_v2.png" width="45", height="45" onclick="ringoBtn()">
            <br>
            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            <div class="titleScripts">
                <h1>ã“ã‚“ãƒ¬ã‚¤ãƒ©ï¼</h1>
            </div>
            <!--ul class="follow-me">
                <li><a href="https://twitter.com"></a></li>
                <li><a href="https://www.youtube.com"></a></li>
            </ul-->
            <div class="button" id="button_sch">
                <a onclick="show_sch()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã“ã¡ã‚‰</a>
            </div>
    
            <label for="switch" class="switch_label" id="switch_label">
                <span class="title_blkapi">block API</span>
                <div class="switch"> 
                    <input type="checkbox" id="switch" />
                    <div class="circle"></div>
                    <div class="base"></div>
                </div>
            </label>
    
            <script src="https://code.jquery.com/jquery-3.3.1.js"  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
            <script type="text/javascript" src="keys.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
            <script type="text/javascript">
            const K_LIST = []; //ã‚­ãƒ¼ã‚’ç·¨é›†
            const Y_API_KEY1 = config.y_apikey_1;
            const Y_API_KEY2 = config.y_apikey_2;
            const Y_API_KEY3 = config.y_apikey_3;
            const Y_API_KEY_D1 = config.y_apikey_d1;
            const Y_API_KEY_D2 = config.y_apikey_d2;
            const DEV_KEY = config.dev_key;
            K_LIST.push(Y_API_KEY1);
            K_LIST.push(Y_API_KEY2);
            K_LIST.push(Y_API_KEY3);
            const max = K_LIST.length;
    
    
            $(function() {
                if (checkbox.checked) {
                    console.log("block_api")
                    return;
                }
                const promiseFunc = (value,value2) => {
                return new Promise((resolve, reject) => {
                    //console.log(value + value2);
                    $.ajax({
                    type: 'GET',
                    url: value + value2,
                    datatype: 'json',
                    success: function(json){
                        resolve(json.items);
                    },
                    error: function(){
                        reject();
                        
                        Swal.fire({
                            type: "warning",
                            title: "èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼",
                            html: "ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>æã‚Œå…¥ã‚Šã¾ã™ãŒå†èª­ã¿è¾¼ã¿ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚<br><br>è§£æ±ºã—ãªã„å ´åˆã¯ãŠæ‰‹æ•°ã§ã™ãŒã€ä¸‹è¨˜ãƒªãƒ³ã‚¯ã‚ˆã‚ŠãŠå•åˆã›ãã ã•ã„ã€‚",
                            footer: '<a href="https://ringodeveloper.github.io/kon-layla/qa.html" target="_blank">ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Šã™ã‚‹</a>',
                        });
                    }
                    });
                });
                };
                
                // éåŒæœŸé–¢æ•°
                async function asyncFunc() {
                    // ä¸¦è¡Œã—ã¦å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã€å…¨ã¦ã®å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§å¾…æ©Ÿ
                    const values_upcoming = await Promise.all([
                        promiseFunc(base_youtube_url,'&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=upcoming'),
                    ]);
        
                    const values_live = await Promise.all([
                        promiseFunc(base_youtube_url,'&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=live'),
                    ]);
        
                    const values_completed = await Promise.all([
                        promiseFunc(base_youtube_url,'&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=completed')
                    ]);

                    /*
                    const values_channel = await Promise.all([
                        promiseFunc(base_youtube_url_channel,'&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ')
                    ]);
                    */
                    
        
                    const jsonitem_u = values_upcoming.flat();
                    const jsonitem_l = values_live.flat();
                    const jsonitem_c = values_completed.flat();
                    //const jsonitem_cn = values_channel.flat();
                    
                    /*
                    for (var i = 0; i < jsonitem_cn.length; i++) {
                        console.log(jsonitem_cn[i]);
                    }
                    */

                    if (jsonitem_l.length < 1) {
                        document.getElementById("youtubeList_l").style.visibility = "hidden";
                    } else {
                        $("#youtubeList_l").append('<h2 class="statetext">é…ä¿¡ä¸­ğŸ¥</h2>');
                        for(var i = 0; i < jsonitem_l.length; i++){
                        var ID = jsonitem_l[i].id.videoId;
                        $("#youtubeList_l").append('<iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe>');
                    }
                    }
        
        
                    

                    //sort of upcom live
                    let videoId_u = [];
                    let videoId_u_string = '';
                    let video_u_obj_list = [];
                    loop: for(var i = jsonitem_u.length-1; i >= 0; i--){
                        if ((jsonitem_l.length != 0) && (jsonitem_l[0].id.videoId == jsonitem_u[i].id.videoId)) {
                            continue;
                        }
                        for (j = 0; j < jsonitem_c.length; j++) {
                            if (jsonitem_u[i].id.videoId == jsonitem_c[j].id.videoId) {
                                continue loop;
                            }
                        }
                        var ID = jsonitem_u[i].id.videoId;
                        videoId_u.push(ID);
                        videoId_u_string += (ID + ',');
                        //console.log(videoId_u_string);
                        //$("#youtubeList_u").append('<iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe>');
                    }
                    (function ($) {
                        $(function () {
                            $.ajax({
                                url: (base_youtube_url_live+videoId_u_string) + '&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=completed',
                                type: 'GET',
                                dataType: "json",
                                }).done(function (data) {
                                // success
                                //å–å¾—jsonãƒ‡ãƒ¼ã‚¿
                                var data_stringify = JSON.stringify(data);
                                var data_json = JSON.parse(data_stringify);
                                //jsonãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                                let jsonitem_ld = data_json["items"];
                                for (let i = 0; i < jsonitem_ld.length; i++) {
                                    time = Date.parse(jsonitem_ld[i].liveStreamingDetails.scheduledStartTime);
                                    date = new Date(time);
                                    video_u_obj_list.push({videoid: videoId_u[i], time: date});
                                }
                                let video_u_obj_list_sorted = video_u_obj_list.sort(
                                    (a, b) => moment(a.time).diff(b.time)
                                );
                                //console.log(video_u_obj_list_sorted);
                                for (let i = 0; i < video_u_obj_list_sorted.length; i++) {
                                    var ID = video_u_obj_list_sorted[i].videoid;
                                    var DATETIME = video_u_obj_list_sorted[i].time;
                                    var year = DATETIME.getFullYear() ;	// å¹´
                                    var month = DATETIME.getMonth() + 1 ;	// æœˆ
                                    var day = DATETIME.getDate() ;	// æ—¥
                                    var hour = DATETIME.getHours() ;	// æ™‚
                                    var minute = DATETIME.getMinutes() ;	// åˆ†
                                    var second = DATETIME.getSeconds() ;	// ç§’
                                    var dayOfWeek = DATETIME.getDay() ;	// æ›œæ—¥(æ•°å€¤)
                                    var dayOfWeekStr = [ "æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ" ][dayOfWeek] ;	// æ›œæ—¥(æ—¥æœ¬èªè¡¨è¨˜)
                                    var DATETIME_formated = `${month}/${day} (${dayOfWeekStr}) ${hour}:${minute.toString().padStart(2, '0')}`;
                                    $("#youtubeList_u_inner").append('<div class="iframe_wrapper"><h2 class="sc-time">' +DATETIME_formated + '</h2><iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe></div>'); /////
                                    //$("#youtubeList_u_inner").append(''); /////
                                }
                            }).fail(function (data) {
                            // error
                            console.log('error');
                            });
                        });
                    })(jQuery);

                    //sort op comp live
                    let videoId_c = [];
                    let videoId_c_string = '';
                    let video_c_obj_list = [];
                    for(var i = 0; i < jsonitem_c.length; i++){
                        var ID = jsonitem_c[i].id.videoId;
                        videoId_c.push(ID);
                        videoId_c_string += (ID + ',');
                        //$("#youtubeList_c").append('<iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe>'); /////
                    }
                    (function ($) {
                        $(function () {
                            $.ajax({
                                url: (base_youtube_url_live+videoId_c_string) + '&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=completed',
                                type: 'GET',
                                dataType: "json",
                                }).done(function (data) {
                                // success
                                //å–å¾—jsonãƒ‡ãƒ¼ã‚¿
                                var data_stringify = JSON.stringify(data);
                                var data_json = JSON.parse(data_stringify);
                                //jsonãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                                let jsonitem_ld = data_json["items"];
                                var time_total = 0;
                                for (let i = 0; i < jsonitem_ld.length; i++) {
                                    start_time = Date.parse(jsonitem_ld[i].liveStreamingDetails.actualStartTime);
                                    end_time = Date.parse(jsonitem_ld[i].liveStreamingDetails.actualEndTime);
                                    //console.log((end_time - start_time) / 1000);
                                    time_total += Math.floor((end_time - start_time) / 1000);
                                    date = new Date(start_time);
                                    video_c_obj_list.push({videoid: videoId_c[i], time: date});
                                }
                                //console.log(time_total);
                                let time_total_ave = Math.floor(time_total / 20);
                                const time_total_sec = (time_total_ave%60).toString().padStart(2, '0');
                                const time_total_min = (Math.floor(time_total_ave/60)%60).toString().padStart(2, '0');
                                const time_total_hour = Math.floor(time_total_ave/3600)%60;
                        
                                time_total_ave_formated = `${time_total_hour}:${time_total_min}:${time_total_sec}`;
                                $(".statetext_top").append('<h2 class="ave_time">æœ€è¿‘20å›ã®å¹³å‡é…ä¿¡æ™‚é–“  ' + time_total_ave_formated + '</h2>');
                                let video_c_obj_list_sorted = video_c_obj_list.sort(
                                    (a, b) => moment(b.time).diff(a.time)
                                );
                                for (let i = 0; i < video_c_obj_list_sorted.length; i++) {
                                    var DATETIME = video_c_obj_list_sorted[i].time;
                                    var year = DATETIME.getFullYear() ;	// å¹´
                                    var month = DATETIME.getMonth() + 1 ;	// æœˆ
                                    var day = DATETIME.getDate() ;	// æ—¥
                                    var hour = DATETIME.getHours() ;	// æ™‚
                                    var minute = DATETIME.getMinutes() ;	// åˆ†
                                    var second = DATETIME.getSeconds() ;	// ç§’
                                    var dayOfWeek = DATETIME.getDay() ;	// æ›œæ—¥(æ•°å€¤)
                                    var dayOfWeekStr = [ "æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ" ][dayOfWeek] ;	// æ›œæ—¥(æ—¥æœ¬èªè¡¨è¨˜)
                                    var DATETIME_formated = `${month}/${day} (${dayOfWeekStr}) ${hour}:${minute.toString().padStart(2, '0')}`;
                                    var ID = video_c_obj_list_sorted[i].videoid;
                                    //$("#youtubeList_c_inner").append('<div class="iframe_wrapper"><h2>' +DATETIME_formated + '</h2><iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe></div>'); /////
                                    $("#youtubeList_c_inner").append('<div class="iframe_wrapper_c"><iframe src="https://www.youtube.com/embed/' + ID + '" frameborder="1" sandbox="allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads allow-modals" allowfullscreen></iframe></div>'); /////
                                    
                                }
                            }).fail(function (data) {
                            // error
                            console.log('error');
                            });
                        });
                    })(jQuery);
                    /*
                    const values_completed_details = Promise.all([
                        promiseFunc((base_youtube_url_live+videoId_c_string),'&channelId=UCm-nZofnh3_1s_l2Gq3G1KQ&eventType=completed')
                    ]);
                    console.log(values_completed_details);
                    const jsonitem_ld = values_completed_details.flat();
                    
                    
                    */
                }
                
    
                asyncFunc();
            });
            </script>
    
            <div class="contents-wapper2"> 
                <div id="youtubeList_l">
                </div>
                <div id="youtubeList_u">
                    <h2 class="statetext">é…ä¿¡äºˆå®š</h2>
                    <div id="youtubeList_u_inner"></div>
                </div>
                <div id="youtubeList_c">
                    <div class="statetext_top">
                        <h2 class="statetext">éå»ã®é…ä¿¡</h2>
                    </div>
                    

                    <div id="youtubeList_c_inner"></div>
                </div>
            </div>
        </main>
        
        <footer>
            <ul class="footer_menu">
                <a href="https://ringodeveloper.github.io/kon-layla/README.txt"><li id="version">Ver. 0.1.4</li></a>
                <li><br></li>
                <a href="https://twitter.com/_ringodev_"><li id="cc">&copy; 2023 ã‚Šã‚“ã”ã§ã¹ã‚ã£ã± All Rights Reserved.</li></a>
            </ul>
        </footer>

        <script src="./js/sample.js"></script>
    </body>
    
</html>

